---
layout: default
title: Tasks
---
<section class="annotate">
	<p><strong>Pomander is all about tasks</strong>. We've included tasks for managing application deployments, and basic database backup and merging.</p>
	<pre class="terminal"><code data-language="shell">
config            # Create development environment configuration
db:backup         # Perform a backup suited for merging.
db:create         # Create database.
db:destroy        # Wipe database.
db:full           # Perform a full database backup.
db:merge          # Merge a backup into environment.
deploy:cold       # First time deployment.
deploy:setup      # Setup application in environment.
deploy:update     # Update code to latest changes.
init              # Set it up
rollback          # Rollback to previous release
	</code></pre>
	<p>You can define new tasks, add to existing tasks, or even run tasks before or after another task.</p>
	<p>Any defined task can be invoked from the command line.</p>
	<p>Pomander's task system is built on top of <a href="https://github.com/jaz303/phake">Phake</a>.</p>
</section>

<section class="annotate">
	<h2>Defining Tasks</h2>
	<p>Provide a task name, and a callback function. The task name is how you invoke the task, and the callback can be anything that <code>is_callable</code>.</p>
	<pre><code data-language="php">
desc("My first task");
task('the_task_name', function($app) {
  info('the_task_name', 'I am running!');
  if(!$app-&gt;super_secret_setting)
    warn('secret', 'You forgot to set the super secret setting..');
});
	</code></pre>
	<p>Every task is passed <code>$app</code>. Use <code>$app-&gt;env</code> to get to the current environment, and use <code>$app['KEY']</code> to access any defined command line variables.</p>
	<p>Call <code>desc("")</code> just before your task definition to attach a description to it. <code>pom -T</code> will only show tasks that have a description.</p>
</section>

<section class="annotate">
	<h2>Task Dependencies</h2>
	<p>The first string in the task method will always define the name of the task.</p>
	<pre><code data-language="php">
task('sass', function($app) {
	exec_cmd("");
});

task('coffee', function($app) {
	exec_cmd("cofee");
});

desc("Compile application assets");
task('assets', 'sass', 'coffee', function($app) {

});
	</code></pre>
	<p>Subsequent strings passed before the callable block are dependency tasks that are run <strong>before</strong> the main task can run.</p>
</section>

<section class="annotate">
	<h2>Groups</h2>
	<p>Wrap some tasks in a group to... group tasks.</p>
	<pre><code data-language="php">
group('files', function() {
  task('sync', function($app) {   // invoked with files:sync
    info("files", "uploading files");
    put("./files/", "{$app->env->shared_dir}/files");
  });

  task('backup', function($app) { // invoked with files:backup
    info("files", "backing them up");
    get("{$app->env->shared_dir}/files/", "./files/");
  });
});
	</code></pre>
	<p>Group tasks are invoked by <code>group_name:task_name</code>.</p>
</section>

<section class="annotate">
	<h2>After/Before Blocks</h2>
	<p>They look just like the <code>task</code> method, but they will run before/after the task you specify.</p>
	<pre><code data-language="php">
after('deploy:update', function($app) {
  info("deploy", "All done!");
});

before('db:backup', function($app) {
  if(!$app-&gt;env-&gt;db)
    abort("backup", "Please add database settings first.");
});

// $ pom db:backup
//  * abort backup Please add database settings first.
//
//
// $ pom deploy:update
//  * info deploy Deploying code..
//  * info deploy All done!
	</code></pre>
</section>

<section>
	<h2>Helper Methods</h2>
	<ul class="settings">
		<li>
			<code data-language="php">info($label, $message)</code>
			<p>Output a pretty line of text. Typically used for displaying progress.</p>
		</li>
		<li>
			<code data-language="php">warn($label, $message)</code>
			<p>Used to warn user about something that may be broken or misconfigured, but won't necessarily cause the task to fail.</p>
		</li>
		<li>
			<code data-language="php">abort($label, $message, $exit_code = 1)</code>
			<p>Warns user that something went wrong, and exits Pomander with an error.</p>
		</li>
		<li>
			<code data-language="php">run()</code>
			<p>Runs a string or array of commands on the environment's target (remote server).</p>
		</li>
		<li>
			<code data-language="php">exec_cmd()</code>
			<p>Runs a string or array of commands locally.</p>
		</li>
		<li>
			<code data-language="php">put($what, $where)</code>
			<p>Uploads a file/folder from the local machine to the environment's target.</p>
		</li>
		<li>
			<code data-language="php">get($what, $where)</code>
			<p>Retrieves file/folder from the environment's target to a local location</p>
		</li>
	</ul>
</section>
